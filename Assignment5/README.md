# Assignment5

This folder contains all the code written to generate PDSCH DMRS signals according to TS 38.211 using MATLAB. 



Demodulation Reference Signals (DMRS) are used for channel estimation in the 5G NR setup. In this simulation multiport DMRS is generated over a single specified slot. Specifications from the following have been used to develop this code

- TS 38.211
  - Section 7.4.1.1
  - Section 5.2.1
- TS 38.214 
  - Section 4.1
  - Section 5.1.2.2.1 
- TS 38.331



## Contents

The following is a brief summary of the necessary scripts to generate the DMRS symbols



- __PDSCH_DMRS.m__: Main script used to generate the DMRS

- __PDSCH_DMRS_config.m__: Configuration file specifying parameters for the DMRS

- __test_vector{1/2/3}.m__: Configuration file corresponding to the sample test vector {1/2/3} generated for [Systemvue](https://www.keysight.com/in/en/products/software/pathwave-design-software/pathwave-system-design-software.html)

- __only_dmrs_config{1/2/3}.mat__: Resource grid (only BWP region) corresponding to test_vector{1/2/3}.m generated by Systemvue

- __c_sequence.m___: Script to generate the c(n) sequence specified by TS 38.211 5.2.1

- __Table{1/2/3/4/5}.m__: Scripts to capture the information contained in tables 7.4.1.1.2-{1/2/3/4/5}

- __nominalRBG_P.m__: Script to capture the information captured in Table 5.1.2.2.1-1 in TS 38.214

     

## Usage

### PDSCH_DMRS_config.m

This is the configuration file that governs the generation of the DMRS symbols. 

### PDSCH_DMRS.m

The file can be run as usual in MATLAB. It expects the ```Table{1/2/3/4/5}.m``` , ```c_sequence.m``` and the ```nominalRBG_P.m``` files to be present in the same directory. The configuration can be specified in the format described by ```PDSCH_DMRS_config.m```. The exact filename can be specified in the ```run``` function given in the __Defining variables__ section of the code shown below

```
%%
clear; clc;

%% Defining variables

run("PDSCH_DMRS_config.m");
% run("test_vector1.m");
% run("test_vector2.m");
% run("test_vector3.m");

```

Removing the comment from any of the ```run("test_vector{1/2/3}.m")``` statement will produce the output corresponding to one of the sample configurations supplied. The accuracy of the results produced for any of the test vectors can also be verified using the __Verifying accuracy__ section of the code shown below

``` %% Verifying accuracy
% filename = "only_dmrs_config1.mat";
% filename = "only_dmrs_config2.mat";
% filename = "only_dmrs_config3.mat";
tfGrid = load(filename);
loaded = tfGrid.output;
% 
dims = size(loaded);
accuracy = sum(sum(loaded == multiport_RG_DMRS_output))/(dims(1)*dims(2)) 
```

To compare the output generated with the ___only_dmrs_config{1/2/3}.mat__ file, remove the comment from the appropriate line. __NOTE:__ This accuracy measurement only applies to the supplied test vectors and not to other files. It must be commented out when running any other configuration!

Other configurations can be specified by modifying the ```PDSCH_DMRS_config.m``` file and choosing to run that file.



#### Outputs

The ```PDSCH_DMRS.m``` file produces the following outputs

- __Plots__ (display): These are heatmaps of the resource grid (only active BWP) displaying the allocated DMRS symbols
- __DMRS_output.mat__: A .mat file with the generated time frequency grid. The data is saved with the variable name __multiport_RG_DMRS_output__ of dimension (BWP_size, 14, num. of Ports). The output .mat file can be renamed by changing the __outputFilename__ parameter in ```PDSCH_DMRS_config.m.```